<!DOCTYPE html>
<html lang="en">
<head>
      <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-C3LDF2V8MF"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-C3LDF2V8MF');
</script>
  <meta charset="UTF-8" />
  <title>WeaveTXT – Neighbor Tail / Head</title>
  <link rel="icon" href="logo.svg" type="image/svg+xml">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    :root {
      --bg-main: #222;
      --bg-card: #333;
      --bg-tile: #444;
      --bg-tile-empty: #2b2b2b;
      --bg-tile-selected: #3f3f3f;
      --accent: #ffb347;
      --accent-soft: #ffecb3;
      --accent-border: #ff9800;
      --text-main: #f5f5f5;
      --text-muted: #aaa;
      --text-soft: #ddd;
    }

    * { box-sizing: border-box; }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #2b3a4a 0, #111 55%);
      color: var(--text-main);
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 16px;
      margin: 0;
    }

    /* BRANDING */
    #brand {
      display: flex;
      align-items: baseline;
      gap: 6px;
      margin-top: 6px;
      margin-bottom: 4px;
    }

    .brand-weave {
      font-family: "Georgia", serif;
      font-size: clamp(22px, 5vw, 30px);
      font-weight: bold;
      letter-spacing: 0.03em;
    }

    .brand-txt {
      font-family: "Courier New", monospace;
      font-size: clamp(18px, 4.5vw, 24px);
      font-weight: bold;
      color: var(--accent);
      border-right: 2px solid var(--accent);
      padding-right: 4px;
      animation: caret-blink 0.9s step-end infinite;
      min-width: 3ch;
    }

    @keyframes caret-blink {
      0%, 100% { border-color: transparent; }
      50% { border-color: var(--accent); }
    }

    h1 {
      margin: 2px 0 0;
      font-size: clamp(20px, 5vw, 26px);
      text-align: center;
    }

    #subtitle {
      font-size: 12px;
      margin-top: 4px;
      margin-bottom: 14px;
      color: var(--text-muted);
      text-align: center;
      text-transform: uppercase;
      letter-spacing: 0.12em;
    }

    /* GAME CARD */
    #game-container {
      background: var(--bg-card);
      padding: 16px 14px 18px;
      border-radius: 10px;
      box-shadow: 0 0 18px rgba(0,0,0,0.55);
      max-width: 520px;
      width: 100%;
      border: 1px solid #414141;
    }

    #top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
      flex-wrap: wrap;
      font-size: 13px;
    }

    #points-label {
      font-size: 13px;
      font-weight: 600;
      color: var(--text-soft);
    }

    #points {
      color: var(--accent);
      font-weight: 700;
      margin-left: 4px;
    }

    #puzzle-info {
      font-size: 11px;
      color: var(--text-muted);
      text-align: right;
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 4px;
    }

    #puzzle-counter {
      white-space: nowrap;
    }

    #level-select {
      font-size: 12px;
      padding: 2px 6px;
      border-radius: 6px;
      border: 1px solid #555;
      background: #252525;
      color: var(--text-main);
    }

    /* INSTRUCTIONS */
    .instructions {
      font-size: 12px;
      line-height: 1.5;
      color: var(--text-soft);
      margin-bottom: 10px;
    }

    .instructions strong {
      color: var(--accent-soft);
    }

    /* WORD ROWS */
    #word-rows {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-bottom: 12px;
      font-family: "Courier New", monospace;
      font-size: clamp(18px, 4.5vw, 22px);
    }

    .word-row {
      background: var(--bg-tile-empty);
      padding: 8px 12px;
      border-radius: 8px;
      letter-spacing: 3px;
      border: 1px solid #444;
    }

    /* CONTROLS */
    #controls {
      margin-top: 4px;
      border-top: 1px solid #444;
      padding-top: 10px;
      font-size: 13px;
    }

    #guess-section {
      margin-bottom: 10px;
    }

    #guess-input {
      width: 100%;
      padding: 8px 10px;
      border-radius: 8px;
      border: 1px solid #555;
      background: #252525;
      color: var(--text-main);
      font-size: 16px;
    }

    #guess-input::placeholder {
      color: #777;
    }

    #guess-input:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 4px rgba(255, 179, 71, 0.7);
    }

    .button-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: center;
      margin-bottom: 6px;
    }

    button {
      border: none;
      border-radius: 999px;
      padding: 7px 14px;
      font-size: 13px;
      cursor: pointer;
      background: var(--accent);
      color: #222;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.4);
      transition: background 0.1s ease, transform 0.07s ease, box-shadow 0.07s ease;
      min-width: 110px;
      justify-content: center;
    }

    button:hover:not(:disabled) {
      background: #ffab2c;
      transform: translateY(-1px);
      box-shadow: 0 3px 9px rgba(0,0,0,0.6);
    }

    button:disabled {
      background: #555;
      color: #999;
      cursor: default;
      transform: none;
      box-shadow: none;
    }

    #reveal-btn {
      background: #555;
      color: var(--text-main);
    }

    #reveal-btn:hover:not(:disabled) {
      background: #666;
    }

    #next-btn {
      background: #444;
      color: var(--text-main);
    }

    #next-btn:hover:not(:disabled) {
      background: #555;
    }

    #cost-info {
      font-size: 11px;
      color: var(--text-muted);
      text-align: center;
      margin-bottom: 6px;
    }

    #message {
      min-height: 24px;
      font-size: 12px;
      text-align: center;
      margin-top: 2px;
      white-space: pre-line;
    }

    .msg-success { color: #9be59b; }
    .msg-error   { color: #ff9d9d; }
    .msg-warning { color: var(--accent); }
    .msg-info    { color: var(--accent-soft); }

    /* FOOTER */
    #footer {
      margin-top: 12px;
      padding-top: 8px;
      border-top: 1px solid #444;
      font-size: 11px;
      color: var(--text-muted);
      text-align: center;
    }

    #footer a {
      color: var(--accent);
      text-decoration: none;
      font-weight: 600;
    }

    #footer a:hover {
      text-decoration: underline;
    }

    /* MOBILE */
    @media (max-width: 480px) {
      #game-container {
        padding: 14px 10px 16px;
      }
      #top-bar {
        flex-direction: column;
        align-items: flex-start;
      }
      #puzzle-info {
        align-items: flex-start;
      }
      .word-row {
        font-size: 18px;
      }
      .instructions {
        font-size: 11px;
      }
      #cost-info {
        font-size: 10.5px;
      }
    }
  </style>
</head>
<body>
  <!-- BRAND -->
  <div id="brand">
    <span class="brand-weave">Weave</span>
    <span class="brand-txt" id="brand-txt"></span>
  </div>

  <h1>Neighbor Tail / Head</h1>
  <div id="subtitle">Guess the shared 3-letter pattern</div>
  <h4>30th November 2025 </h4>

  <div id="game-container">
    <div id="top-bar">
      <div id="points-label">
        Points:
        <span id="points">15</span>
      </div>
      <div id="puzzle-info">
        <span id="puzzle-counter">Puzzle 1 / 7</span>
        <label style="font-size:11px;">
          Level:
          <select id="level-select"></select>
        </label>
      </div>
    </div>

    <p class="instructions">
      You see four related words, but part of each word is hidden.<br />
      Your goal is to guess the <strong>3-letter pattern</strong> they all share
      (either at the <em>beginning</em> or the <em>end</em>).
    </p>

    <div id="word-rows">
      <div class="word-row"></div>
      <div class="word-row"></div>
      <div class="word-row"></div>
      <div class="word-row"></div>
    </div>

    <div id="controls">
      <div id="guess-section">
        <label for="guess-input">Type the shared 3-letter pattern:</label>
        <input id="guess-input" type="text" maxlength="3" autocomplete="off" placeholder="3 letters" />
      </div>

      <div class="button-row">
        <button id="submit-btn">Submit</button>
        <button id="reveal-btn">Reveal a Letter</button>
        <button id="next-btn" disabled>Next Puzzle</button>
      </div>

      <div id="cost-info">
        Wrong guess: <strong>-5</strong> points · Reveal 1 letter: <strong>-10</strong> points<br />
        You lose if your points reach <strong>0</strong> or below.
      </div>

      <div id="message" class="msg-info"></div>
    </div>

    <!-- FOOTER -->
    <div id="footer">
      More from WeaveTXT:
      <a href="https://www.weavetxt.com/index.html" target="_blank" rel="noopener noreferrer">
        Swap and Weave
      </a>
      ·
      <a href="https://www.weavetxt.com/solitaire.html" target="_blank" rel="noopener noreferrer">
        Weave Solitaire
      </a>
      ·
      <a href="https://www.weavetxt.com/steal.html" target="_blank" rel="noopener noreferrer">
        Steal & Weave
      </a>
      ·
      <a href="https://www.weavetxt.com/book/chapter1.html" target="_blank" rel="noopener noreferrer">
        Geometry of Batik
      </a>
     ·     
       <a href="https://www.weavetxt.com/rgb.html" target="_blank" rel="noopener noreferrer">
        Geometry of Batik
      </a>
        ·     
       <a href="https://www.weavetxt.com/bomb.html" target="_blank" rel="noopener noreferrer">
        Bomb Hunt
      </a>
          
    </div>
  </div>

  <!-- Dictionary (MUST define: const VALID_WORDS = [...] ) -->
  <script src="valid-3-6.js"></script>

  <script>
    /* -------- TXT animation -------- */
    (function animateTXT(){
      const el = document.getElementById("brand-txt");
      const word = "TXT";
      let i = 0;
      let forward = true;

      function loop(){
        el.textContent = word.slice(0, i);

        if (forward) {
          i++;
          if (i > word.length) {
            forward = false;
            setTimeout(loop, 800);
            return;
          }
        } else {
          i--;
          if (i < 0) {
            forward = true;
            setTimeout(loop, 600);
            return;
          }
        }
        setTimeout(loop, 110);
      }

      loop();
    })();

    /* -------- Game data -------- */
    const puzzles = [
      {
        name: "Puzzle 1 – g s n c",
        mode: "tail",
        prefixes: ["g", "s", "n", "c"],
        suffix: "ame",
        words: ["game", "same", "name", "came"],
        hint: "Everyday words; two are things you can play."
      },
      {
        name: "Puzzle 2 – f k b w",
        mode: "tail",
        prefixes: ["f", "k", "b", "w"],
        suffix: "ind",
        words: ["find", "kind", "bind", "wind"],
        hint: "All rhyme with 'find'."
      },
      {
        name: "Puzzle 3 – b d p m",
        mode: "tail",
        prefixes: ["b", "d", "p", "m"],
        suffix: "ark",
        words: ["bark", "dark", "park", "mark"],
        hint: "Animal voice, lighting, and a place to relax."
      },
      {
        name: "Puzzle 4 – c b l h",
        mode: "tail",
        prefixes: ["c", "b", "l", "h"],
        suffix: "old",
        words: ["cold", "bold", "gold", "hold"],
        hint: "Temperature, courage, precious metal, and grip."
      },
      {
        name: "Puzzle 5 – t b c h",
        mode: "tail",
        prefixes: ["t", "b", "c", "h"],
        suffix: "ook",
        words: ["took", "book", "cook", "hook"],
        hint: "Time, reading, food, and fishing."
      },
      {
        name: "Puzzle 6 – h r y n",
        mode: "tail",
        prefixes: ["h", "r", "y", "n"],
        suffix: "ear",
        words: ["hear", "rear", "year", "near"],
        hint: "Sound, position, and time."
      },
      {
        name: "Puzzle 7 – n p b y",
        mode: "head",
        prefix: "swa",
        endings: ["n", "p", "b", "y"],
        words: ["swan", "swap", "swab", "sway"],
        hint: "Bird, exchange, medical tool, and movement."
      },
      {
        name: "Puzzle 6 – l d c m",
        mode: "tail",
        prefixes: ["l", "d", "c", "m"],
        suffix: "ove",
        words: ["love", "dove", "cove", "move"],
        hint: "No hint"
      }
    ];

    let currentIndex = 0;
    let points = 15;
    let revealed = [false, false, false]; // three pattern letters
    let gameOver = false;

    // This controls what the rows display.
    // Normally it's the canonical affix, but if the player finds a different valid pattern,
    // we switch this to their pattern so the board shows THEIR family.
    let displayAffix = null;

    const pointsSpan = document.getElementById("points");
    const puzzleCounterSpan = document.getElementById("puzzle-counter");
    const levelSelectEl = document.getElementById("level-select");
    const wordRows = document.querySelectorAll(".word-row");
    const guessInput = document.getElementById("guess-input");
    const submitBtn = document.getElementById("submit-btn");
    const revealBtn = document.getElementById("reveal-btn");
    const nextBtn = document.getElementById("next-btn");
    const messageDiv = document.getElementById("message");

    // STRICT dictionary: must exist, no window.VALID_WORDS
    let WORD_SET = null;
    let DICT_READY = false;

    function initDictionary() {
      if (typeof VALID_WORDS === "undefined" || !Array.isArray(VALID_WORDS)) {
        alert("ERROR: valid-3-6.js not loaded or VALID_WORDS is not an array.\nGame requires VALID_WORDS.");
        DICT_READY = false;
        return false;
      }
      WORD_SET = new Set(VALID_WORDS.map(w => w.toUpperCase()));
      DICT_READY = true;
      return true;
    }

    // Initialize dictionary once at load
    initDictionary();

    function setMessage(text, type = "info") {
      messageDiv.textContent = text;
      messageDiv.className = "msg-" + type;
    }

    function currentPuzzle() {
      return puzzles[currentIndex];
    }

    function getCanonicalAffix(puzzle) {
      return puzzle.mode === "head" ? puzzle.prefix : puzzle.suffix;
    }

    function getAffixForDisplay(puzzle) {
      // Use player's affix if they've found one, otherwise canonical
      return displayAffix || getCanonicalAffix(puzzle);
    }

    function updatePuzzleCounter() {
      puzzleCounterSpan.textContent = `Puzzle ${currentIndex + 1} / ${puzzles.length}`;
    }

    function initLevelSelect() {
      levelSelectEl.innerHTML = "";
      puzzles.forEach((p, idx) => {
        const opt = document.createElement("option");
        opt.value = idx;
        opt.textContent = p.name;
        levelSelectEl.appendChild(opt);
      });

      levelSelectEl.value = String(currentIndex);
      levelSelectEl.addEventListener("change", () => {
        currentIndex = parseInt(levelSelectEl.value, 10) || 0;
        resetGameState();
      });
    }

    function updateWordRows() {
      const puzzle = currentPuzzle();
      const affix = getAffixForDisplay(puzzle);

      const chars = [];
      for (let i = 0; i < 3; i++) {
        if (revealed[i]) {
          chars.push(affix[i]);
        } else {
          chars.push("_");
        }
      }
      const chunkDisplay = chars.join(" ");

      if (puzzle.mode === "tail") {
        for (let i = 0; i < 4; i++) {
          wordRows[i].textContent = puzzle.prefixes[i] + " " + chunkDisplay;
        }
      } else {
        for (let i = 0; i < 4; i++) {
          wordRows[i].textContent = chunkDisplay + " " + puzzle.endings[i];
        }
      }
    }

    function updatePoints() {
      pointsSpan.textContent = points;
    }

    function endGameWin(patternGuess, wordsUsed) {
      gameOver = true;
      displayAffix = patternGuess.toLowerCase();  // show player's pattern on board
      revealed = [true, true, true];
      updateWordRows();
      setMessage(
        `Nice! "${patternGuess.toUpperCase()}" makes a valid family.\nWords: ${wordsUsed.join(", ")}\nFinal points: ${points}`,
        "success"
      );
      submitBtn.disabled = true;
      revealBtn.disabled = true;
      nextBtn.disabled = false;
    }

    function endGameLost() {
      gameOver = true;
      // On lose we keep canonical affix (displayAffix remains default)
      revealed = [true, true, true];
      updateWordRows();
      const puzzle = currentPuzzle();
      const canonicalAffix = getCanonicalAffix(puzzle).toUpperCase();
      setMessage(
        `You ran out of points.\nOne valid pattern was "${canonicalAffix}".`,
        "error"
      );
      submitBtn.disabled = true;
      revealBtn.disabled = true;
      nextBtn.disabled = false;
    }

    function handleSubmit() {
      if (gameOver) return;

      if (!DICT_READY) {
        setMessage("Dictionary not loaded. Check valid-3-6.js.", "error");
        return;
      }

      const raw = guessInput.value.trim().toLowerCase();
      if (raw.length !== 3) {
        setMessage("Please enter exactly 3 letters.", "warning");
        return;
      }

      const puzzle = currentPuzzle();
      let candidateWordsLower;

      if (puzzle.mode === "tail") {
        candidateWordsLower = puzzle.prefixes.map(p => p + raw);
      } else {
        candidateWordsLower = puzzle.endings.map(e => raw + e);
      }

      const candidateWordsUpper = candidateWordsLower.map(w => w.toUpperCase());
      const allValid = candidateWordsUpper.every(w => WORD_SET.has(w));

      if (allValid) {
        endGameWin(raw, candidateWordsUpper);
        return;
      }

      points -= 5;
      updatePoints();
      if (points <= 0) {
        endGameLost();
      } else {
        setMessage(`Not quite. -5 points. Try again! (Remaining: ${points})`, "error");
      }
    }

    function handleReveal() {
      if (gameOver) return;

      if (!DICT_READY) {
        setMessage("Dictionary not loaded. Check valid-3-6.js.", "error");
        return;
      }

      const puzzle = currentPuzzle();
      const affix = getAffixForDisplay(puzzle);

      const unrevealedIndices = [];
      for (let i = 0; i < 3; i++) {
        if (!revealed[i]) unrevealedIndices.push(i);
      }

      if (unrevealedIndices.length === 0) {
        setMessage("All letters are already revealed.", "warning");
        return;
      }

      points -= 10;
      updatePoints();

      const randIndex = unrevealedIndices[Math.floor(Math.random() * unrevealedIndices.length)];
      revealed[randIndex] = true;
      updateWordRows();

      const revealedChar = affix[randIndex].toUpperCase();

      if (points <= 0) {
        setMessage(
          `Revealed letter: position ${randIndex + 1} is "${revealedChar}".\nBut your points dropped to ${points}.`,
          "error"
        );
        endGameLost();
      } else {
        setMessage(
          `Revealed letter: position ${randIndex + 1} is "${revealedChar}". (Points: ${points})`,
          "warning"
        );
      }
    }

    function nextPuzzle() {
      currentIndex = (currentIndex + 1) % puzzles.length;
      resetGameState();
    }

    function resetGameState() {
      points = 15;
      revealed = [false, false, false];
      gameOver = false;
      submitBtn.disabled = false;
      revealBtn.disabled = false;
      nextBtn.disabled = true;
      guessInput.value = "";
      const puzzle = currentPuzzle();
      displayAffix = getCanonicalAffix(puzzle); // reset to canonical at start
      updateWordRows();
      updatePoints();
      updatePuzzleCounter();
      levelSelectEl.value = String(currentIndex);
      setMessage(puzzle.hint, "info");
      guessInput.focus();
    }

    // Events
    submitBtn.addEventListener("click", handleSubmit);
    revealBtn.addEventListener("click", handleReveal);
    nextBtn.addEventListener("click", nextPuzzle);
    guessInput.addEventListener("keyup", (e) => {
      if (e.key === "Enter") handleSubmit();
    });

    // Init
    initLevelSelect();
    resetGameState();
  </script>
</body>
</html>
